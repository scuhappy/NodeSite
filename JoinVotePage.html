<html>

<head>
	<link href="node_modules/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body style="background:#7ED87C;">
<a href = "/index.html"><h2>MainPage</h2></a>
<h3  >Join Vote</h3>
<p class="text-danger"><b><em>Score Rules:
<li class="text-danger">1, All the input number should between 0~9</li>
<li class="text-danger">2, You should input one and only one 9 score,one or more than one 0 score. And other score .</li>
</em></b></P>

<div>
<label>Vote Select :</label>
<select class='combobox form-control' name='inline' id="VoteNumberCombo" style="width:80" onchange="RefreshTable()">
</select>
</div>

<table class="table" action="SubmitVote" >
<thread>
<tr>
<th>Name</th>
<th>Content</th>
<th>Score</th>
</tr>
</thread>
<tbody id = "TableBody">

</tbody>
</table>
<div>
<input type="submit" value="submit score" class="btn btn-lg btn-default" id='SubmitBtn' onclick="SendScore()"/>
</div>

</body>
 <script src="node_modules/jquery/dist/jquery.min.js"></script>
<script>
var addInput = "<tr>\
<td>\
<label for='firstname' class='PersonNameLabel'>Person Name</label>\
</td>\
<td>\
<label for='firstname' class='PersonContentLabel'>Person Content</label>\
</td>\
<td>\
<input class='PersonScoreInput' type='text' style='width:50px;' />\
</td>\
</tr>";
var VoteContent;

var AddPerson = function(){
	console.log("add person");
        $("#TableBody").append(addInput);
};
var GetData = function(){
        $.get("GetAllVoteContent",function(result){
		console.log(JSON.parse(result));
                VoteContent = JSON.parse(result);//all the votes
                console.log(VoteContent);
                for(var m=0;m<VoteContent.Votes.length;m++)
                {
                    var option=$("<option ></option>").text(VoteContent.Votes[m].Date);
                    $("#VoteNumberCombo").append(option);

                }
                for(var n=0;n<VoteContent.Votes[0].Persons.length;n++)
                {
                    var row = $("<tr class="VoteRow"></tr>");
                    var col1 = $("<td></td>");
                    var col1content = $("<label></label>").text(VoteContent.Votes[0].Persons[n].PersonName);
                    var col2 =     $("<td></td>");
                    var col2content = $("<label></label>").text(VoteContent.Votes[0].Persons[n].PersonContent);
                    var col3 = $("<td></td>");
                    var col3content = $("<input class='PersonScoreInput' type='text' style='width:50px;' />");
                    col1.append(col1content);
                    col2.append(col2content);
                    col3.append(col3content);
                    row.append(col1,col2,col3);
                    $("#TableBody").append(row);
                }
	});
};
var SendScore = function(){
		var flag9=0;
		var flag0 = 0;
                var _Scores = {'Scores':[]};
                $(".VoteRow").each(function(){
                        $(this).children("")
                })
                for(var i=0;i<$(".PersonScoreInput").length;i++)
		{
			if($(".PersonScoreInput").eq(i).val()=="")
			{
				alert("Please input score for all the people!");
				return;
			}
			else if(parseInt($(".PersonScoreInput").eq(i).val())>9 || parseInt($(".PersonScoreInput").eq(i).val())<0)
			{
				alert("Score should be between 0~9!");
				return;
			}
			else if(parseInt($(".PersonScoreInput").eq(i).val())==9)
			{
				if(flag9==0)
				{
					flag9=1;
				}
				else 
				{
					alert("Just allow one '9' in scores!");
					return ;
				}
			}
			else if(parseInt($(".PersonScoreInput").eq(i).val())==0)
			{
				flag0=1;
			}
                        var _Score= {"PersonName":,"Score":$(".PersonScoreInput").eq(i).val()}
                        VoteContent.Person[i].PersonScore= parseInt);
			console.log(VoteContent.Person[i].PersonScore);
		}
		if(flag9==0)//Do not have one 9
		{
			alert("You should input at least one 9 score!");
			return;
		}
		else if(flag0==0)
		{
			alert("You should input at least one 0 score!");
			return;
		}
		$.post("SendScore",{data:JSON.stringify(VoteContent)},function(result){
			window.location.href ="JoinVotePage.html";
		});
}
var GetVotedStatus=function(){
	$.get("GetVoteStatus",function(result){
		console.log(result);
		if(result== "Voted")
		{
			$('#SubmitBtn').attr('disabled','true');
		}else{
			$('#SubmitBtn').removeAttr('disabled');
		}
	});
};
var RefreshTable=function(){
    console.log("refresh table!!!");
    //Clear the table
    $("#TableBody").empty();

    var _date = $("#VoteNumberCombo").find("option:selected").text();
    //Add table body
    for(var m=0;m<VoteContent.Votes.length;m++)
    {
        if(VoteContent.Votes[m].Date == _date)
        {
            for(var p=0;p<VoteContent.Votes[m].Persons.length;p++)
            {
                var row = $("<tr ></tr>");
                var col1 = $("<td></td>");
                var col1content = $("<label></label>").text(VoteContent.Votes[m].Persons[p].PersonName);
                var col2 =     $("<td></td>");
                var col2content = $("<label></label>").text(VoteContent.Votes[m].Persons[p].PersonContent);
                var col3 = $("<td></td>");
                var col3content = $("<input class='PersonScoreInput' type='text' style='width:50px;' />");
                col1.append(col1content);
                col2.append(col2content);
                col3.append(col3content);
                row.append(col1,col2,col3);
                $("#TableBody").append(row);
            }
            break;
        }
    }

};
GetVotedStatus();
GetData();
</script>
</html>
