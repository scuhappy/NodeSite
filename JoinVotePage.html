<html>

<head>
<link href="//cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
</head>

<body style="background:#7ED87C;">
<a href = "/index.html"><h2>MainPage</h2></a>
<h3  >Join Vote</h3>
<p class="text-danger"><b><em>Score Rules:
<li class="text-danger">1, All the input number should between 0~9</li>
<li class="text-danger">2, You should input one and only one 9 score,one or more than one 0 score. And other score .</li>
</em></b></P>

<p action="SubmitVote" id = "FormScore"></p>
<div>
<input type="submit" value="submit score" class="btn btn-lg btn-default" onclick="SendScore()"/>
</div>

</body>
<script src="http://libs.baidu.com/jquery/1.10.2/jquery.min.js"></script>
<script>
var addInput = "<div><label for='firstname' class='PersonContentLabel'>Person Content</label>	<input class='PersonScoreInput' type='text' style='width:50px;' />	<label class='PersonScoreLabel'>score</label></div>";
var VoteContent;

var AddPerson = function(){
	console.log("add person");
	$("#FormScore").append(addInput);
};
var GetData = function(){
	$.get("GetVoteContent",function(result){
		VoteContent = JSON.parse(result);
		for(var i=0;i<VoteContent.Person.length;i++)
		{
			AddPerson();
		}
		console.log($(".PersonContentLabel").length);
		for(var i=0;i<VoteContent.Person.length;i++)
		{
			$(".PersonContentLabel")[i].innerHTML ="Name : "+VoteContent.Person[i].PersonName+" /  Post Content : "+VoteContent.Person[i].PersonContent+" Score : ";
			$(".PersonScoreLabel")[i].innerHTML= VoteContent.Person[i].PersonScore;
		}
	});
};
var SendScore = function(){
		VoteContent.MessageType ="SendScore";
		var flag9=0;
		var flag0 = 0;
		for(var i=0;i<VoteContent.Person.length;i++)
		{
			if($(".PersonScoreInput").eq(i).val()=="")
			{
				alert("Please input score for all the people!");
				return;
			}
			else if(parseInt($(".PersonScoreInput").eq(i).val())>9 || parseInt($(".PersonScoreInput").eq(i).val())<0)
			{
				alert("Score should be between 0~9!");
				return;
			}
			else if(parseInt($(".PersonScoreInput").eq(i).val())==9)
			{
				if(flag9==0)
				{
					flag9=1;
				}
				else 
				{
					alert("Just allow one '9' in scores!");
					return ;
				}
			}
			else if(parseInt($(".PersonScoreInput").eq(i).val())==0)
			{
				flag0=1;
			}
			
			VoteContent.Person[i].PersonScore= parseInt($(".PersonScoreInput").eq(i).val());
			console.log(VoteContent.Person[i].PersonScore);
		}
		if(flag9==0)//Do not have one 9
		{
			alert("You should input at least one 9 score!");
			return;
		}
		else if(flag0==0)
		{
			alert("You should input at least one 0 score!");
			return;
		}
		$.post("SendScore",JSON.stringify(VoteContent),function(result){
			window.location.href ="JoinVotePage.html";
		});
}
GetData();
</script>
</html>