<html>

<head>
	<link href="node_modules/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body style="background:#7ED87C;">
<a href = "/index.html"><h2>MainPage</h2></a>
<h3  >Join Vote</h3>
<p class="text-danger"><b><em>Score Rules:
<li class="text-danger">1, All the input number should between 0~9</li>
<li class="text-danger">2, You should input one and only one 9 score,one or more than one 0 score. And other score .</li>
</em></b></P>

<p >
<label id ="VoteTimeLabel">Vote date:</label>
</p>
<table class="table" action="SubmitVote" >
<thread>
<tr>
<th>Name</th>
<th>Content</th>
<th>Score</th>
</tr>
</thread>
<tbody id = "FormScore">

</tbody>
</table>
<div>
<input type="submit" value="submit score" class="btn btn-lg btn-default" id='SubmitBtn' onclick="SendScore()"/>
</div>

</body>
 <script src="node_modules/jquery/dist/jquery.min.js"></script>
<script>
var addInput = "<tr><td><label for='firstname' class='PersonNameLabel'>Person Name</label></td><td><label for='firstname' class='PersonContentLabel'>Person Content</label></td><td><input class='PersonScoreInput' type='text' style='width:50px;' /></td></tr>";
var VoteContent;

var AddPerson = function(){
	console.log("add person");
	$("#FormScore").append(addInput);
};
var GetData = function(){
	$.get("GetVoteContent",function(result){
		console.log(JSON.parse(result));
		VoteContent = JSON.parse(result);
		console.log(VoteContent.VoteCreateDate);
		$("#VoteTimeLabel").text("Vote Create Date: "+VoteContent.VoteCreateDate);
		for(var i=0;i<VoteContent.Person.length;i++)
		{
			AddPerson();
		}
		for(var i=0;i<VoteContent.Person.length;i++)
		{
			$(".PersonNameLabel")[i].innerHTML =VoteContent.Person[i].PersonName;
			$(".PersonContentLabel")[i].innerHTML =VoteContent.Person[i].PersonContent;
			//$(".PersonScoreLabel")[i].innerHTML= VoteContent.Person[i].PersonScore;
		}
	});
};
var SendScore = function(){
		VoteContent.MessageType ="SendScore";
		var flag9=0;
		var flag0 = 0;
		for(var i=0;i<VoteContent.Person.length;i++)
		{
			if($(".PersonScoreInput").eq(i).val()=="")
			{
				alert("Please input score for all the people!");
				return;
			}
			else if(parseInt($(".PersonScoreInput").eq(i).val())>9 || parseInt($(".PersonScoreInput").eq(i).val())<0)
			{
				alert("Score should be between 0~9!");
				return;
			}
			else if(parseInt($(".PersonScoreInput").eq(i).val())==9)
			{
				if(flag9==0)
				{
					flag9=1;
				}
				else 
				{
					alert("Just allow one '9' in scores!");
					return ;
				}
			}
			else if(parseInt($(".PersonScoreInput").eq(i).val())==0)
			{
				flag0=1;
			}
			
			VoteContent.Person[i].PersonScore= parseInt($(".PersonScoreInput").eq(i).val());
			console.log(VoteContent.Person[i].PersonScore);
		}
		if(flag9==0)//Do not have one 9
		{
			alert("You should input at least one 9 score!");
			return;
		}
		else if(flag0==0)
		{
			alert("You should input at least one 0 score!");
			return;
		}
		$.post("SendScore",{data:JSON.stringify(VoteContent)},function(result){
			window.location.href ="JoinVotePage.html";
		});
}
var GetVotedStatus=function(){
	$.get("GetVoteStatus",function(result){
		console.log(result);
		if(result== "Voted")
		{
			$('#SubmitBtn').attr('disabled','true');
		}else{
			$('#SubmitBtn').removeAttr('disabled');
		}
	});
};
GetVotedStatus();
GetData();
</script>
</html>