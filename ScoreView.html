<html>
<head>
    <!-- Bootstrap core CSS -->
	<link href="node_modules/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body  style="background:#7ED87C;">
<h1><a href="index.html">Main Page</a></h1>
<h3>View Score Page</h3>
<div>
<label>Vote Number Select :</label>
<select class='combobox form-control' name='inline' id="VoteNumberCombo" style="width:80" onchange="RefreshTable()">
</select>
</div>

<table class="table" >
<thread>
<tr id="TableHeader">
</tr>
</thread>
<tbody id = "TableBody">

</tbody>
</table>
</body>
<script src="node_modules/jquery/dist/jquery.min.js"></script>
<script src="node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
<script>
var Votes;
$.get("GetAllVoteContent",function(result){
    Votes = JSON.parse(result);
    for(var i = 0;i<Votes.Votes.length;i++)
    {
        var option=$("<option ></option>").text(Votes.Votes[i].Date);
        $("#VoteNumberCombo").append(option);
    }
    RefreshTable();
});
var RefreshTable=function(){
    console.log("refresh table!!!");

    //Clear the table
    $("#TableHeader").empty();
    $("#TableBody").empty();

    var _date = $("#VoteNumberCombo").find("option:selected").text();

    var lockHeader = "<th>Name</th><th>Sum Score</th>";
    $("#TableHeader").append(lockHeader);
    for(var i = 0;i<Votes.Votes.length;i++)
    {
        if(Votes.Votes[i].Date == _date)
        {
            Votei = Votes.Votes[i];
            //Add header
            for(var j = 0;j<Votei.VoteStatus.length;j++)
            {
                     var _name= Votei.VoteStatus[j].PersonName;
                     var head=$("<th ></th>").text(_name);
                     $("#TableHeader").append(head);
            }


            //Add table body
            //Sort the list by score
            var _Persons = SortPersons(Votes.Votes[i].Persons);
            console.log("qweqwwqewqe");
            for(var p=0;p<_Persons.length;p++)//For every row
            {
                var row = $("<tr ></tr>");
                var col1 = $("<td></td>");
                var _PersonName = _Persons[p].PersonName;
                var col1content = $("<label></label>").text(_PersonName);
                var col2 =     $("<td></td>");
                var _PPScore = _Persons[p].PersonScore;
                var col2content = $("<label></label>").text(_PPScore);
                col1.append(col1content);
                col2.append(col2content);
                row.append(col1,col2);

                for(var q = 0;q<Votes.Votes[i].VoteStatus.length;q++)//for every person
                {
                    var flag=0;
                    for(var n = 0;n<Votes.Votes[i].VoteStatus[q].Scores.length;n++)//for each person 's every score
                    {
                        if(Votes.Votes[i].VoteStatus[q].Scores[n].PersonName ==_PersonName)//check if the score is for current person
                        {
                            flag = 1;
                            var _PersonScore = Votes.Votes[i].VoteStatus[q].Scores[n].Score;
                            var col =     $("<td></td>");
                            var colcontent = $("<label></label>").text(_PersonScore);
                            col.append(colcontent);
                            row.append(col);
                            break;
                        }
                    }
                    if(flag==0)//not scored
                    {
                        var col =     $("<td></td>");
                        var colcontent = $("<label></label>").text("None");
                        col.append(colcontent);
                        row.append(col);
                    }
                }
                $("#TableBody").append(row);
            }
            break;
        }
    }

};
var SortPersons= function(Persons){
       for(var i = 1;i<Persons.length;i++)
       {
            console.log("asdasdasdas : "+Persons.length);
           for(var j =0;j<i;j++)
           {
               if(parseInt(Persons[i].PersonScore)>=parseInt(Persons[j].PersonScore))
               {
                    var tmp = Persons[i];
                    for(var m=i;m>j;m--)
                    {
                            Persons[m]=Persons[m-1];
                    }
                    Persons[j] = tmp;
                    console.log("bbbbbbbbbbbbbb");
                    break;
               }
            }
       }
       return Persons;
};
</script>
</html>
